CREATE PROCEDURE EXT.SP_INBOUND_PRE_TEAMTITLETOPYE
(
    IN in_TEAMFIELD VARCHAR(75),   /* RESOLVE: Manual edits required: VARCHAR2 parameter(no length): user-configured length=75; adjust as needed */
                                   /* ORIGSQL: in_TEAMFIELD IN VARCHAR2 */
    IN in_TITLEFIELD VARCHAR(75)   /* RESOLVE: Manual edits required: VARCHAR2 parameter(no length): user-configured length=75; adjust as needed */
                                   /* ORIGSQL: in_TITLEFIELD IN VARCHAR2 */
)
LANGUAGE SQLSCRIPT
SQL SECURITY DEFINER
DEFAULT SCHEMA EXT
/*READS SQL DATA*/ -- this procedure cannot be read-only
AS
BEGIN
    /* sapdbmtk: one or more DECLARE statements below were moved upwards, before the first executable statement */
    DECLARE v_sql VARCHAR(32000);  /* ORIGSQL: v_sql varchar2(32000); */

    /* RESOLVE: Identifier not found: Table/view 'DBMTK_USER_NAME.INBOUND_DATA_STAGING' not found */
    /* ORIGSQL: update inbound_Data_Staging SET error_Flag=2; */
    UPDATE inbound_Data_Staging
        SET
        /* ORIGSQL: error_Flag = */
        error_Flag = 2
    FROM
        inbound_Data_Staging;

    v_sql = ' insert  into inbound_Data_Staging
    SELECT FILETYPE,
    FILENAME,
    FILEDATE,
    ERROR_MESSAGE,
    0,
    SEQ+rownum,
    FIELD1,
    FIELD2,
    FIELD3,
    FIELD4,
    FIELD5,
    FIELD6,
    FIELD7,
    FIELD8,
    FIELD9,
    FIELD10,
    FIELD11,
    FIELD12,
    FIELD13,
    FIELD14,
    FIELD15,
    FIELD16,
    FIELD17,
    FIELD18,
    FIELD19,
    FIELD20,
    FIELD21,
    FIELD22,
    FIELD23,
    FIELD24,
    FIELD25,
    FIELD26,
    FIELD27,
    FIELD28,
    FIELD29,
    FIELD30,
    FIELD31,
    FIELD32,
    FIELD33,
    FIELD34,
    FIELD35,
    FIELD36,
    FIELD37,
    FIELD38,
    FIELD39,
    FIELD40,
    FIELD41,
    FIELD42,
    FIELD43,
    FIELD44,
    FIELD45,
    FIELD46,
    FIELD47,
    FIELD48,
    FIELD49,
    FIELD50,
    FIELD51,
    FIELD52,
    FIELD53,
    FIELD54,
    FIELD55,
    FIELD56,
    FIELD57,
    FIELD58,
    FIELD59,
    FIELD60,
    FIELD61,
    FIELD62,
    FIELD63,
    FIELD64,
    FIELD65,
    FIELD66,
    FIELD67,
    FIELD68,
    FIELD69,
    FIELD70,
    FIELD71,
    FIELD72,
    FIELD73,
    FIELD74,
    FIELD75,
    FIELD76,
    FIELD77,
    FIELD78,
    FIELD79,
    FIELD80,
    FIELD81,
    FIELD82,
    FIELD83,
    FIELD84,
    FIELD85,
    FIELD86,
    FIELD87,
    FIELD88,
    FIELD89,
    FIELD90,
    FIELD91,
    FIELD92,
    FIELD93,
    FIELD94,
    FIELD95,
    FIELD96,
    FIELD97,
    FIELD98,
    FIELD99,
    p.name,
    FIELD101,
    FIELD102,
    FIELD103,
    FIELD104,
    FIELD105,
    FIELD106,
    FIELD107,
    FIELD108,
    FIELD109,
    FIELD110,
    FIELD111,
    FIELD112,
    FIELD113,
    FIELD114,
    FIELD115,
    FIELD116,
    FIELD117,
    FIELD118,
    FIELD119,
    FIELD120,
    FIELD121,
    FIELD122,
    FIELD123,
    FIELD124,
    FIELD125,
    FIELD126,
    FIELD127,
    FIELD128,
    FIELD129,
    FIELD130,
    FIELD131,
    FIELD132,
    FIELD133,
    FIELD134,
    FIELD135,
    FIELD136,
    FIELD137,
    FIELD138,
    FIELD139,
    FIELD140,
    FIELD141,
    FIELD142,
    FIELD143,
    FIELD144,
    FIELD145,
    FIELD146,
    FIELD147,
    FIELD148,
    FIELD149,
    FIELD150,
    FIELD151,
    FIELD152,
    FIELD153,
    FIELD154,
    FIELD155,
    FIELD156,
    FIELD157,
    FIELD158,
    FIELD159,
    FIELD160,
    FIELD161,
    FIELD162,
    FIELD163,
    FIELD164,
    FIELD165,
    FIELD166,
    FIELD167,
    FIELD168,
    FIELD169,
    FIELD170,
    FIELD171,
    FIELD172,
    FIELD173,
    FIELD174,
    FIELD175,
    FIELD176,
    FIELD177,
    FIELD178,
    FIELD179,
    FIELD180,
    FIELD181,
    FIELD182,
    FIELD183,
    FIELD184,
    FIELD185,
    FIELD186,
    FIELD187,
    FIELD188,
    FIELD189,
    FIELD190,
    FIELD191,
    FIELD192,
    FIELD193,
    FIELD194,
    FIELD195,
    FIELD196,
    FIELD197,
    FIELD198,
    FIELD199,
    field200
    FROM INBOUND_DATA_STAGING a
    join (select distinct p.name, p.genericattribute1 team, t.name title from cs_position@STELEXT p
        join cs_title@stelext t
        on t.ruleelementownerseq=p.titleseq
        and t.removedate>sysdate and t.effectiveenddate>sysdate
        where p.removedate>sysdate and p.effectiveenddate>sysdate
        
    ) p
    on nvl(a.' ||IFNULL(:in_TEAMFIELD,'')||',''NOTEAM'') = nvl(p.team,''NOTEAM'')
    and a.' ||IFNULL(:in_TITLEFIELD,'')||'=p.title
    union
    SELECT FILETYPE,
    FILENAME,
    FILEDATE,
    ERROR_MESSAGE,
    0,
    SEQ+rownum,
    FIELD1,
    FIELD2,
    FIELD3,
    FIELD4,
    FIELD5,
    FIELD6,
    FIELD7,
    FIELD8,
    FIELD9,
    FIELD10,
    FIELD11,
    FIELD12,
    FIELD13,
    FIELD14,
    FIELD15,
    FIELD16,
    FIELD17,
    FIELD18,
    FIELD19,
    FIELD20,
    FIELD21,
    FIELD22,
    FIELD23,
    FIELD24,
    FIELD25,
    FIELD26,
    FIELD27,
    FIELD28,
    FIELD29,
    FIELD30,
    FIELD31,
    FIELD32,
    FIELD33,
    FIELD34,
    FIELD35,
    FIELD36,
    FIELD37,
    FIELD38,
    FIELD39,
    FIELD40,
    FIELD41,
    FIELD42,
    FIELD43,
    FIELD44,
    FIELD45,
    FIELD46,
    FIELD47,
    FIELD48,
    FIELD49,
    FIELD50,
    FIELD51,
    FIELD52,
    FIELD53,
    FIELD54,
    FIELD55,
    FIELD56,
    FIELD57,
    FIELD58,
    FIELD59,
    FIELD60,
    FIELD61,
    FIELD62,
    FIELD63,
    FIELD64,
    FIELD65,
    FIELD66,
    FIELD67,
    FIELD68,
    FIELD69,
    FIELD70,
    FIELD71,
    FIELD72,
    FIELD73,
    FIELD74,
    FIELD75,
    FIELD76,
    FIELD77,
    FIELD78,
    FIELD79,
    FIELD80,
    FIELD81,
    FIELD82,
    FIELD83,
    FIELD84,
    FIELD85,
    FIELD86,
    FIELD87,
    FIELD88,
    FIELD89,
    FIELD90,
    FIELD91,
    FIELD92,
    FIELD93,
    FIELD94,
    FIELD95,
    FIELD96,
    FIELD97,
    FIELD98,
    FIELD99,
    p.name,
    FIELD101,
    FIELD102,
    FIELD103,
    FIELD104,
    FIELD105,
    FIELD106,
    FIELD107,
    FIELD108,
    FIELD109,
    FIELD110,
    FIELD111,
    FIELD112,
    FIELD113,
    FIELD114,
    FIELD115,
    FIELD116,
    FIELD117,
    FIELD118,
    FIELD119,
    FIELD120,
    FIELD121,
    FIELD122,
    FIELD123,
    FIELD124,
    FIELD125,
    FIELD126,
    FIELD127,
    FIELD128,
    FIELD129,
    FIELD130,
    FIELD131,
    FIELD132,
    FIELD133,
    FIELD134,
    FIELD135,
    FIELD136,
    FIELD137,
    FIELD138,
    FIELD139,
    FIELD140,
    FIELD141,
    FIELD142,
    FIELD143,
    FIELD144,
    FIELD145,
    FIELD146,
    FIELD147,
    FIELD148,
    FIELD149,
    FIELD150,
    FIELD151,
    FIELD152,
    FIELD153,
    FIELD154,
    FIELD155,
    FIELD156,
    FIELD157,
    FIELD158,
    FIELD159,
    FIELD160,
    FIELD161,
    FIELD162,
    FIELD163,
    FIELD164,
    FIELD165,
    FIELD166,
    FIELD167,
    FIELD168,
    FIELD169,
    FIELD170,
    FIELD171,
    FIELD172,
    FIELD173,
    FIELD174,
    FIELD175,
    FIELD176,
    FIELD177,
    FIELD178,
    FIELD179,
    FIELD180,
    FIELD181,
    FIELD182,
    FIELD183,
    FIELD184,
    FIELD185,
    FIELD186,
    FIELD187,
    FIELD188,
    FIELD189,
    FIELD190,
    FIELD191,
    FIELD192,
    FIELD193,
    FIELD194,
    FIELD195,
    FIELD196,
    FIELD197,
    FIELD198,
    FIELD199,
    field200
    FROM INBOUND_DATA_STAGING a
    join (select distinct name, genericattribute1 team from cs_position@STELEXT
    where removedate>sysdate and effectiveenddate>sysdate) p
    on a.' ||IFNULL(:in_TEAMFIELD,'')||'=p.name';

    /* ORIGSQL: dbms_output.put_line(v_sql); */
    --CALL sapdbmtk.sp_dbmtk_buffered_output_writeln(:v_sql);

    /* ORIGSQL: SP_LOGGER (v_sql, 'Trigger: Start PreSQL-0', NULL, NULL, null) */
    CALL EXT.STEL_SP_LOGGER(:v_sql, 'Trigger: Start PreSQL-0', NULL, NULL, NULL);

    /* ORIGSQL: SP_LOGGER (SUBSTR(v_sql, 4000, 8000), 'Trigger: Start PreSQL-0', NULL, NULL, nul(...) */
    CALL EXT.STEL_SP_LOGGER(SUBSTRING(:v_sql,4000,8000) 
        , 'Trigger: Start PreSQL-0', NULL, NULL, NULL);  /* ORIGSQL: SUBSTR(v_sql, 4000, 8000) */

    /* RESOLVE: Dynamically generated SQL: Dynamically generated SQL, as executed by Execute-Immediate, convert manually */
    /* ORIGSQL: execute immediate v_sql; */
    EXECUTE IMMEDIATE :v_sql;

    /* RESOLVE: Identifier not found: Table/view 'DBMTK_USER_NAME.INBOUND_DATA_STAGING_ARCH' not found */

    /* ORIGSQL: insert into inbound_data_staging_Arch select sysdate, a.* from inbound_data_stag(...) */
    INSERT INTO inbound_data_staging_Arch
        SELECT   /* ORIGSQL: select sysdate, a.* from inbound_data_staging a where error_flag=2; */
            CURRENT_TIMESTAMP,
            a.*
        FROM
            inbound_data_staging a
        WHERE
            error_flag = 2;  

    /* ORIGSQL: update inbound_Data_Staging SET error_flag=1 where error_Flag=2 and error_messag(...) */
    UPDATE inbound_Data_Staging
        SET
        /* ORIGSQL: error_flag = */
        error_flag = 1
    FROM
        inbound_Data_Staging
    WHERE
        error_Flag = 2
        AND error_message IS NOT NULL;

    /* ORIGSQL: delete from inbound_Data_Staging where error_Flag=2 and error_message IS NULL; */
    DELETE
    FROM
        inbound_Data_Staging
    WHERE
        error_Flag = 2
        AND error_message IS NULL;

    /* ORIGSQL: commit; */
    COMMIT;
END